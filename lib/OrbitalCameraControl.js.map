{"version":3,"sources":["../src/OrbitalCameraControl.js"],"names":["getCursorPos","e","touches","x","pageX","y","pageY","clientX","clientY","UP","fromValues","ANGLE_LIMIT","Math","PI","OrbitalCameraControl","mViewMatrix","mRadius","mListenerTarget","window","_mtxTarget","_radius","_targetRadius","_listenerTarget","_isDown","_rotation","create","center","easing","senstivity","senstivityRotation","_isLocked","_isZoomLocked","_rx","_trx","_prevx","_ry","_try","_prevy","_quat","_vec","_mtx","_mouseDown","_mouse","_init","addEventListener","_onDown","_onUp","_onMove","_onWheel","mValue","w","wheelDelta","d","detail","value","dx","dy","identity","rotateY","rotateX","set","transformQuat","lookAt","copy"],"mappings":"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","file":"OrbitalCameraControl.js","sourcesContent":["import { vec3, mat4, quat } from 'gl-matrix';\n\nconst getCursorPos = function (e) {\n\tif(e.touches) {\n\t\treturn {\n\t\t\tx:e.touches[0].pageX,\n\t\t\ty:e.touches[0].pageY\n\t\t};\n\t} else {\n\t\treturn {\n\t\t\tx:e.clientX,\n\t\t\ty:e.clientY\n\t\t};\n\t}\n};\n\nconst UP = vec3.fromValues(0, 1, 0);\nconst ANGLE_LIMIT = (Math.PI/2 - 0.01);\n\nclass OrbitalCameraControl {\n\tconstructor(mViewMatrix, mRadius = 5, mListenerTarget = window) {\n\t\tthis._mtxTarget = mViewMatrix;\n\t\tthis._radius = mRadius;\n\t\tthis._targetRadius = mRadius;\n\t\tthis._listenerTarget = mListenerTarget;\n\t\tthis._isDown = false;\n\t\tthis._rotation = mat4.create();\n\t\tthis.center = vec3.create();\n\n\t\tthis.easing = 0.1;\n\t\tthis.senstivity = 1;\n\t\tthis.senstivityRotation = 1;\n\n\t\tthis._isLocked = false;\n\t\tthis._isZoomLocked = false;\n\t\tthis._rx = 0;\n\t\tthis._trx = 0;\n\t\tthis._prevx = 0;\n\t\tthis._ry = 0;\n\t\tthis._try = 0;\n\t\tthis._prevy = 0;\n\n\t\tthis._quat = quat.create();\n\t\tthis._vec = vec3.create();\n\t\tthis._mtx = mat4.create();\n\n\n\t\tthis._mouseDown = {\n\t\t\tx:0,\n\t\t\ty:0\n\t\t};\n\n\t\tthis._mouse = {\n\t\t\tx:0,\n\t\t\ty:0\n\t\t};\n\n\t\tthis._init();\n\t} \n\n\n\t_init() {\n\t\tthis._listenerTarget.addEventListener('mousedown', (e) => this._onDown(e));\n\t\tthis._listenerTarget.addEventListener('mouseup', () => this._onUp());\n\t\tthis._listenerTarget.addEventListener('mousemove', (e) => this._onMove(e));\n\n\t\tthis._listenerTarget.addEventListener('touchstart', (e) => this._onDown(e));\n\t\tthis._listenerTarget.addEventListener('touchend', () => this._onUp());\n\t\tthis._listenerTarget.addEventListener('touchmove', (e) => this._onMove(e));\n\n\t\tthis._listenerTarget.addEventListener('mousewheel', (e) => this._onWheel(e));\n\t\tthis._listenerTarget.addEventListener('DOMMouseScroll', (e) => this._onWheel(e));\n\t}\n\n\n\tlock(mValue) {\n\t\tthis._isLocked = mValue;\n\t}\n\n\n\tlockZoom(mValue) {\n\t\tthis._isZoomLocked = mValue;\n\t}\n\n\n\t_onWheel(e) {\n\t\tif(this._isZoomLocked) {\n\t\t\treturn;\n\t\t}\n\t\tconst w = e.wheelDelta;\n\t\tconst d = e.detail;\n\t\tlet value = 0;\n\t\tif (d) {\n\t\t\tif (w) {\n\t\t\t\tvalue = w / d / 40 * d > 0 ? 1 : -1; // Opera\n\t\t\t} else {\n\t\t\t\tvalue = -d / 3;              // Firefox;         TODO: do not /3 for OS X\n\t\t\t}\n\t\t} else {\n\t\t\tvalue = w / 120; \n\t\t}\n\n\t\tthis._targetRadius += (-value * 2 * this.senstivity);\n\t\tif(this._targetRadius < 0.01) {\n\t\t\tthis._targetRadius = 0.01;\n\t\t}\n\t}\n\n\n\t_onDown(e) {\n\t\tif(this._isLocked) {\treturn;\t}\n\t\tthis._isDown = true;\n\n\t\tthis._mouseDown = getCursorPos(e);\n\t\tthis._mouse = getCursorPos(e);\n\n\t\tthis._prevx = this._trx = this._rx;\n\t\tthis._prevy = this._try = this._ry;\n\t}\n\n\n\t_onMove(e) {\n\t\tif(this._isLocked) {\treturn;\t}\n\t\tif(!this._isDown)\t{\treturn;\t}\n\t\tthis._mouse = getCursorPos(e);\n\t}\n\n\n\t_onUp() {\n\t\tif(this._isLocked) {\treturn;\t}\n\t\tthis._isDown = false;\n\t}\n\n\n\tupdate() {\n\t\tconst dx = this._mouse.x - this._mouseDown.x;\n\t\tconst dy = this._mouse.y - this._mouseDown.y;\n\n\t\tconst senstivity = 0.02 * this.senstivityRotation;\n\t\tthis._try = this._prevy - dx * senstivity;\n\t\tthis._trx = this._prevx - dy * senstivity;\n\n\t\tif(this._trx < -Math.PI/2 + 0.01) {\n\t\t\tthis._trx = -Math.PI/2 + 0.01;\n\t\t} else if(this._trx > Math.PI/2 - 0.01) {\n\t\t\tthis._trx = Math.PI/2 - 0.01;\n\t\t}\n\n\t\tthis._rx += (this._trx - this._rx) * this.easing;\n\t\tthis._ry += (this._try - this._ry) * this.easing;\n\t\tthis._radius += (this._targetRadius - this._radius) * this.easing;\n\n\t\tquat.identity(this._quat);\t\t\n\t\tquat.rotateY(this._quat, this._quat, this._ry);\n\t\tquat.rotateX(this._quat, this._quat, this._rx);\n\n\t\tvec3.set(this._vec, 0, 0, this._radius);\n\t\tvec3.transformQuat(this._vec, this._vec, this._quat);\n\n\t\tmat4.identity(this._mtx);\n\t\tmat4.lookAt(this._mtx, this._vec, this.center, UP);\n\n\n\t\tif(this._mtxTarget) {\n\t\t\tmat4.copy(this._mtxTarget, this._mtx);\n\t\t}\n\t}\n\n}\n\n\nexport default OrbitalCameraControl;"]}